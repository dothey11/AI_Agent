<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Financial Chat Assistant</title>
  <style>
    :root {
      --bg1: #0f1724;
      --bg2: #0b1220;
      --card: rgba(255,255,255,0.03);
      --muted: #9aa6b2;
      --text: #e6f0f6;
      --accent: #00d4ff;
      --accent-2: #ff6b9d;
      --user-grad: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --bot-bg: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.06);
      --shadow: 0 8px 30px rgba(2,6,23,0.6);
      --danger: #ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;margin:0;
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,var(--bg2) 0%,#071028 120%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }
    .container{max-width:980px;margin:20px auto;min-height:calc(100vh - 40px);display:flex;flex-direction:column;border-radius:12px;overflow:hidden;box-shadow:var(--shadow);}
    .header{padding:18px 22px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-bottom:1px solid var(--border);}
    .header-left{display:flex;gap:12px;align-items:center;}
    .logo{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#042028;}
    .title h1{font-size:1.2rem;margin:0;background:linear-gradient(135deg,var(--accent),var(--accent-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .title p{margin:0;font-size:0.85rem;color:var(--muted);}
    .main{display:flex;gap:18px;padding:18px;flex:1;}
    .left{width:320px;background:var(--bg1);border-radius:10px;padding:14px;border:1px solid var(--border);display:flex;flex-direction:column;gap:12px;}
    .right{flex:1;display:flex;flex-direction:column;gap:12px;}
    .welcome{padding:18px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.012),transparent);border:1px solid rgba(255,255,255,0.02);color:var(--muted);}
    .examples{display:grid;gap:10px;margin-top:12px;}
    .example{padding:10px 12px;border-radius:8px;background:var(--card);cursor:pointer;border:1px solid var(--border);color:var(--muted);transition:all .15s ease;}
    .example:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.4);color:var(--text);}
    .chat-container{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:10px;padding:16px;border:1px solid var(--border);display:flex;flex-direction:column;height:100%;min-height:420px;}
    .messages{overflow:auto;padding-right:6px;display:flex;flex-direction:column;gap:14px;flex:1;scroll-behavior:smooth;}
    .message{max-width:78%;padding:14px;border-radius:16px;line-height:1.5;word-break:break-word;}
    .message.user{margin-left:auto;background:var(--user-grad);color:#fff;border-radius:16px 16px 6px 16px;box-shadow:0 10px 30px rgba(0,0,0,0.4);}
    .message.bot{margin-right:auto;background:var(--bot-bg);border:1px solid var(--border);color:var(--text);border-radius:16px 16px 16px 6px;}
    .meta{font-size:0.82rem;color:var(--muted);margin-bottom:8px;}
    .file-attachment{display:flex;gap:10px;align-items:center;margin-top:8px;background:linear-gradient(90deg,rgba(0,212,255,0.02),rgba(255,107,157,0.02));padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);}
    .file-attachment .file-icon{font-size:20px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:8px;background:rgba(255,255,255,0.02);}
    .file-attachment .file-info{flex:1;}
    .file-name{font-weight:600;color:var(--text);}
    .file-size{font-size:0.85rem;color:var(--muted);}
    .typing-indicator{display:flex;align-items:center;gap:12px;margin-top:6px;}
    .typing-dots{padding:10px 14px;border-radius:16px 16px 16px 6px;border:1px solid var(--border);background:var(--bot-bg);}
    .dots{display:flex;gap:6px;}
    .dot{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:pulse 1.3s infinite ease-in-out;}
    .dot:nth-child(2){animation-delay:0.18s}
    .dot:nth-child(3){animation-delay:0.36s}
    @keyframes pulse{0%,60%,100%{transform:scale(0.8);opacity:0.6}30%{transform:scale(1.2);opacity:1}}
    .input-container{padding:14px;border-top:1px solid var(--border);display:flex;gap:12px;align-items:flex-end;background:linear-gradient(180deg,rgba(255,255,255,0.005),transparent);}
    .input-wrapper{display:flex;gap:12px;flex:1;align-items:flex-end;}
    .message-input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:transparent;color:var(--text);resize:none;min-height:46px;max-height:140px;outline:none;}
    .controls{display:flex;gap:12px;align-items:center;}
    .attachment-button{padding:12px 14px;border-radius:12px;background:var(--card);color:var(--accent);border:1px solid var(--border);cursor:pointer;}
    .send-button{padding:12px 16px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#042028;font-weight:600;border:none;cursor:pointer;}
    .selected-file-display{margin-bottom:8px;display:none;gap:12px;align-items:center;padding:10px;border-radius:10px;border:1px solid var(--border);background:linear-gradient(90deg,rgba(0,212,255,0.02),rgba(255,107,157,0.02));}
    .selected-file-display.show{display:flex;}
    .remove-file-button{background:transparent;border:none;color:var(--danger);cursor:pointer;font-size:18px;width:28px;height:28px;border-radius:6px;}
    .upload-progress{width:220px;height:8px;background:rgba(255,255,255,0.02);border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.02);}
    .upload-progress>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .12s linear;}
    @media(max-width:820px){
      .main{flex-direction:column;padding:12px;}
      .left{width:100%;order:2}
      .right{order:1}
      .container{margin:8px;}
    }
  </style>
</head>
<body>
  <div class="container" role="application">
    <div class="header">
      <div class="header-left">
        <div class="logo">FA</div>
        <div class="title">
          <h1>ğŸ’° Financial Assistant [Dothey AI Agent]</h1>
          <p>Asisten pintar untuk analisa & perencanaan keuangan</p>
        </div>
      </div>
      <div id="status" style="color:var(--muted);font-size:0.9rem">Ready</div>
    </div>

    <div class="main">
      <aside class="left">
        <div class="welcome">
          <strong>ğŸ‘‹ Selamat datang</strong>
          <p style="margin-top:8px">Saya siap membantu analisa keuangan, saran investasi, dan memproses file laporan.</p>
          <div style="margin-top:10px;font-size:0.9rem;color:var(--muted)">Contoh pertanyaan:</div>
          <div class="examples">
            <div class="example" onclick="sendExampleQuestion('Bagaimana cara memulai investasi untuk pemula?')">ğŸš€ Memulai investasi untuk pemula</div>
            <div class="example" onclick="sendExampleQuestion('Apa saja jenis investasi jangka panjang?')">ğŸ“ˆ Investasi jangka panjang</div>
            <div class="example" onclick="sendExampleQuestion('Bagaimana cara diversifikasi portfolio?')">ğŸ¯ Diversifikasi portfolio</div>
            <div class="example" onclick="sendExampleQuestion('Kapan waktu terbaik beli saham?')">â° Timing beli saham</div>
          </div>
        </div>
      </aside>

      <section class="right">
        <div class="chat-container" id="chatContainer">
          <div class="messages" id="messages">
            <div class="message bot" id="welcomeMessage" style="max-width:100%">
              <div class="meta"><strong>Selamat datang!</strong></div>
              <div><p style="margin:0;color:var(--muted)">Tanyakan apapun atau unggah file Knowledge untuk Agent AI.</p></div>
            </div>
            <div class="typing-indicator" id="typingIndicator" style="display:none">
              <div class="typing-dots">
                <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
              </div>
            </div>
          </div>
        </div>

        <div class="input-container">
          <div id="selectedFileDisplay" class="selected-file-display">
            <div style="display:flex;gap:10px;align-items:center">
              <div style="width:40px;height:40px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center">ğŸ“</div>
              <div>
                <div id="selectedFileName" class="file-name">filename.pdf</div>
                <div id="selectedFileSize" class="file-size">123 KB</div>
              </div>
            </div>
            <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
              <div class="upload-progress" id="uploadProgress" style="display:none"><div></div></div>
              <button class="remove-file-button" onclick="removeFile()">âœ–</button>
            </div>
          </div>
          <div class="input-wrapper">
            <input type="file" id="fileInput" style="display:none"
                   accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.txt,.png,.jpg,.jpeg"
                   onchange="handleFileSelect(event)" />
            <button class="attachment-button" onclick="document.getElementById('fileInput').click()">ğŸ“</button>
            <textarea class="message-input" id="messageInput" placeholder="Tulis pertanyaan..." rows="1"></textarea>
            <div class="controls"><button class="send-button" onclick="sendMessage()">ğŸ“¤</button></div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
 <script>
  const API_URL = "https://gentleman-consortium-lance-photos.trycloudflare.com/webhook/dothey_agent";
  const chatContainer = document.getElementById("chatContainer");
  const messages = document.getElementById("messages");
  const typingIndicator = document.getElementById("typingIndicator");
  const messageInput = document.getElementById("messageInput");
  const statusEl = document.getElementById("status");
  const fileInput = document.getElementById("fileInput");
  const selectedFileDisplay = document.getElementById("selectedFileDisplay");
  const selectedFileName = document.getElementById("selectedFileName");
  const selectedFileSize = document.getElementById("selectedFileSize");
  const uploadProgress = document.getElementById("uploadProgress");
  const uploadProgressBar = uploadProgress.querySelector("div");

  let selectedFile = null;
  let sessionId = crypto.randomUUID();

  messageInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  function sendExampleQuestion(q) {
    messageInput.value = q;
    sendMessage();
  }

  function handleFileSelect(e) {
    const f = e.target.files[0];
    if (!f) return;
    selectedFile = f;
    selectedFileName.textContent = f.name;
    selectedFileSize.textContent = (f.size / 1024).toFixed(1) + " KB";
    selectedFileDisplay.classList.add("show");
  }

  function removeFile() {
    selectedFile = null;
    fileInput.value = "";
    selectedFileDisplay.classList.remove("show");
  }

  function showTyping() { typingIndicator.style.display = "flex"; }
  function hideTyping() { typingIndicator.style.display = "none"; }

  function addMessage(text, sender) {
    const d = document.createElement("div");
    d.className = "message " + sender;
    const meta = document.createElement("div");
    meta.className = "meta";
    meta.textContent = sender === "user" ? "You" : "Assistant";
    const body = document.createElement("div");
    body.innerHTML = sender === "bot" ? marked.parse(text) : text;
    d.appendChild(meta);
    d.appendChild(body);
    messages.insertBefore(d, typingIndicator);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  function setUploadProgress(p) { uploadProgressBar.style.width = p + "%"; }

  function sendMessage() {
    const msg = messageInput.value.trim();
    if (!msg && !selectedFile) return;

    addMessage(msg || "(file)", "user");
    messageInput.value = "";
    showTyping();
    statusEl.textContent = "Mengirim...";

    const fd = new FormData();
    fd.append("chatInput", msg);
    fd.append("session_id", sessionId);
    if (selectedFile) fd.append("attachment", selectedFile, selectedFile.name);

    const xhr = new XMLHttpRequest();
    xhr.open("POST", API_URL, true);

    xhr.upload.onprogress = e => {
      if (e.lengthComputable) {
        uploadProgress.style.display = "block";
        setUploadProgress((e.loaded / e.total) * 100);
      }
    };

    xhr.onload = () => {
      hideTyping();
      uploadProgress.style.display = "none";
      setUploadProgress(0);
      statusEl.textContent = "Ready";

      if (xhr.status === 200) {
        let raw = xhr.responseText;
        console.log("Raw response:", raw);
        try {
          const r = JSON.parse(raw);
          addMessage(r.answer || "(no response)", "bot");
        } catch (e) {
          console.error("JSON parse error:", e);
          addMessage(raw || "(parse error)", "bot");
        }
      } else {
        addMessage("Error " + xhr.status, "bot");
      }
      removeFile();
    };

    xhr.onerror = () => {
      hideTyping();
      statusEl.textContent = "Error";
      addMessage("(network error)", "bot");
      removeFile();
    };

    xhr.send(fd);
  }
</script>
</body>
</html>



